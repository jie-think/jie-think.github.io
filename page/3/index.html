<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Jie-Think</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="jie blog">
<meta property="og:type" content="website">
<meta property="og:title" content="Jie-Think">
<meta property="og:url" content="http://yoursite.com/page/3/index.html">
<meta property="og:site_name" content="Jie-Think">
<meta property="og:description" content="jie blog">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Jie-Think">
<meta name="twitter:description" content="jie blog">
  
    <link rel="alternate" href="/atom.xml" title="Jie-Think" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    
    <div id="header-inner" class="inner">
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">首页</a>
        
          <a class="main-nav-link" href="/archives">归档</a>
        
          <a class="main-nav-link" href="/about">关于</a>
        
      </nav>
      
    </div>
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Jie-Think</a>
      </h1>
      
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-backend/go/gin/gin_learn_start" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/08/29/backend/go/gin/gin_learn_start/" class="article-date">
  <time datetime="2018-08-29T12:12:00.000Z" itemprop="datePublished">2018-08-29</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/backend/">backend</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/08/29/backend/go/gin/gin_learn_start/">gin learn start</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- Table of Contents -->
        
        <h2 id="learn-go-gin"><a href="#learn-go-gin" class="headerlink" title="learn go gin"></a>learn go gin</h2><p><strong>Params:</strong></p>
<ol>
<li><p>Get req params</p>
<blockquote>
<ol>
<li>如何启动一个服务器.</li>
<li>url 地址中的参数获取.</li>
<li>Get 参数的获取.</li>
</ol>
</blockquote>
</li>
<li><p>post req params</p>
<blockquote>
<ol>
<li>如何获取 POST 请求的参数.</li>
</ol>
</blockquote>
</li>
<li><p>结构化获取参数</p>
<blockquote>
<ol start="2">
<li>如何定义</li>
</ol>
</blockquote>
</li>
</ol>
<p><strong>return:</strong></p>
<ol>
<li>string</li>
<li>json</li>
</ol>
<p><strong>拦截器:</strong></p>
<ol>
<li>如何定义和使用拦截器</li>
</ol>
<h2 id="Params"><a href="#Params" class="headerlink" title="Params"></a>Params</h2><h3 id="1-启动一个简单的服务器"><a href="#1-启动一个简单的服务器" class="headerlink" title="1. 启动一个简单的服务器"></a>1. 启动一个简单的服务器</h3><p>Ex:<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"github.com/gin-gonic/gin"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  r := gin.Default()</span><br><span class="line">  r.GET(<span class="string">"/ping"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    c.JSON(<span class="number">200</span>, gin.H&#123;</span><br><span class="line">      <span class="string">"message"</span>: <span class="string">"pong"</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">  r.Run() <span class="comment">// listen and serve on 0.0.0.0:8080</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://localhost:8080/ping</span><br></pre></td></tr></table></figure>
<p><strong>summary:</strong></p>
<blockquote>
<ol>
<li>导包: <code>import &quot;github.com/gin-gonic/gin&quot;</code></li>
<li>启动一个默认的路由: <code>r := gin.Default()</code></li>
<li>注册路径: <code>r.GET(&quot;/ping&quot;, handlers ...HandlerFunc)</code></li>
<li>启动服务: <code>r.Run()</code> , 默认在8080端口</li>
</ol>
</blockquote>
<h3 id="2-Parameters-in-path"><a href="#2-Parameters-in-path" class="headerlink" title="2. Parameters in path"></a>2. Parameters in path</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  router := gin.Default()</span><br><span class="line"></span><br><span class="line">  <span class="comment">// This handler will match /user/john but will not match /user/ or /user</span></span><br><span class="line">  router.GET(<span class="string">"/user/:name"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    name := c.Param(<span class="string">"name"</span>)</span><br><span class="line">    c.String(http.StatusOK, <span class="string">"Hello %s"</span>, name)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// However, this one will match /user/john/ and also /user/john/send</span></span><br><span class="line">  <span class="comment">// If no other routers match /user/john, it will redirect to /user/john/</span></span><br><span class="line">  router.GET(<span class="string">"/user/:name/*action"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    name := c.Param(<span class="string">"name"</span>)</span><br><span class="line">    action := c.Param(<span class="string">"action"</span>)</span><br><span class="line">    message := name + <span class="string">" is "</span> + action</span><br><span class="line">    c.String(http.StatusOK, message)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  router.Run(<span class="string">":8080"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-Querystring-parameters"><a href="#3-Querystring-parameters" class="headerlink" title="3. Querystring parameters"></a>3. Querystring parameters</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  router := gin.Default()</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Query string parameters are parsed using the existing underlying request object.</span></span><br><span class="line">  <span class="comment">// The request responds to a url matching:  /welcome?firstname=Jane&amp;lastname=Doe</span></span><br><span class="line">  router.GET(<span class="string">"/welcome"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    firstname := c.DefaultQuery(<span class="string">"firstname"</span>, <span class="string">"Guest"</span>)</span><br><span class="line">    lastname := c.Query(<span class="string">"lastname"</span>) <span class="comment">// shortcut for c.Request.URL.Query().Get("lastname")</span></span><br><span class="line"></span><br><span class="line">    c.String(http.StatusOK, <span class="string">"Hello %s %s"</span>, firstname, lastname)</span><br><span class="line">  &#125;)</span><br><span class="line">  router.Run(<span class="string">":8080"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-POST-参数解析"><a href="#4-POST-参数解析" class="headerlink" title="4. POST 参数解析"></a>4. POST 参数解析</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  router := gin.Default()</span><br><span class="line"></span><br><span class="line">  router.POST(<span class="string">"/form_post"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    message := c.PostForm(<span class="string">"message"</span>)</span><br><span class="line">    nick := c.DefaultPostForm(<span class="string">"nick"</span>, <span class="string">"anonymous"</span>)</span><br><span class="line"></span><br><span class="line">    c.JSON(<span class="number">200</span>, gin.H&#123;</span><br><span class="line">      <span class="string">"status"</span>:  <span class="string">"posted"</span>,</span><br><span class="line">      <span class="string">"message"</span>: message,</span><br><span class="line">      <span class="string">"nick"</span>:    nick,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">  router.Run(<span class="string">":8080"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="5-上传文件"><a href="#5-上传文件" class="headerlink" title="5. 上传文件"></a>5. 上传文件</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  router := gin.Default()</span><br><span class="line">  <span class="comment">// Set a lower memory limit for multipart forms (default is 32 MiB)</span></span><br><span class="line">  <span class="comment">// router.MaxMultipartMemory = 8 &lt;&lt; 20  // 8 MiB</span></span><br><span class="line">  router.POST(<span class="string">"/upload"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    <span class="comment">// single file</span></span><br><span class="line">    file, _ := c.FormFile(<span class="string">"file"</span>)</span><br><span class="line">    log.Println(file.Filename)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Upload the file to specific dst.</span></span><br><span class="line">    <span class="comment">// c.SaveUploadedFile(file, dst)</span></span><br><span class="line"></span><br><span class="line">    c.String(http.StatusOK, fmt.Sprintf(<span class="string">"'%s' uploaded!"</span>, file.Filename))</span><br><span class="line">  &#125;)</span><br><span class="line">  router.Run(<span class="string">":8080"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST http://localhost:8080/upload \</span><br><span class="line">  -F <span class="string">"file=@/Users/appleboy/test.zip"</span> \</span><br><span class="line">  -H <span class="string">"Content-Type: multipart/form-data"</span></span><br></pre></td></tr></table></figure>
<h3 id="多文件上传"><a href="#多文件上传" class="headerlink" title="多文件上传"></a>多文件上传</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  router := gin.Default()</span><br><span class="line">  <span class="comment">// Set a lower memory limit for multipart forms (default is 32 MiB)</span></span><br><span class="line">  <span class="comment">// router.MaxMultipartMemory = 8 &lt;&lt; 20  // 8 MiB</span></span><br><span class="line">  router.POST(<span class="string">"/upload"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    <span class="comment">// Multipart form</span></span><br><span class="line">    form, _ := c.MultipartForm()</span><br><span class="line">    files := form.File[<span class="string">"upload[]"</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> _, file := <span class="keyword">range</span> files &#123;</span><br><span class="line">      log.Println(file.Filename)</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Upload the file to specific dst.</span></span><br><span class="line">      <span class="comment">// c.SaveUploadedFile(file, dst)</span></span><br><span class="line">    &#125;</span><br><span class="line">    c.String(http.StatusOK, fmt.Sprintf(<span class="string">"%d files uploaded!"</span>, <span class="built_in">len</span>(files)))</span><br><span class="line">  &#125;)</span><br><span class="line">  router.Run(<span class="string">":8080"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST http://localhost:8080/upload \</span><br><span class="line">  -F <span class="string">"upload[]=@/Users/appleboy/test1.zip"</span> \</span><br><span class="line">  -F <span class="string">"upload[]=@/Users/appleboy/test2.zip"</span> \</span><br><span class="line">  -H <span class="string">"Content-Type: multipart/form-data"</span></span><br></pre></td></tr></table></figure>
<h3 id="Grouping-routes-分组路由"><a href="#Grouping-routes-分组路由" class="headerlink" title="Grouping routes(分组路由)"></a>Grouping routes(分组路由)</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  router := gin.Default()</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Simple group: v1</span></span><br><span class="line">  v1 := router.Group(<span class="string">"/v1"</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    v1.POST(<span class="string">"/login"</span>, loginEndpoint)</span><br><span class="line">    v1.POST(<span class="string">"/submit"</span>, submitEndpoint)</span><br><span class="line">    v1.POST(<span class="string">"/read"</span>, readEndpoint)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Simple group: v2</span></span><br><span class="line">  v2 := router.Group(<span class="string">"/v2"</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    v2.POST(<span class="string">"/login"</span>, loginEndpoint)</span><br><span class="line">    v2.POST(<span class="string">"/submit"</span>, submitEndpoint)</span><br><span class="line">    v2.POST(<span class="string">"/read"</span>, readEndpoint)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  router.Run(<span class="string">":8080"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>分组有利于在分组上定义拦截器.</strong></p>
<h3 id="拦截器"><a href="#拦截器" class="headerlink" title="拦截器"></a>拦截器</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="comment">// Creates a router without any middleware by default</span></span><br><span class="line">  r := gin.New()</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Global middleware</span></span><br><span class="line">  <span class="comment">// Logger middleware will write the logs to gin.DefaultWriter even if you set with GIN_MODE=release.</span></span><br><span class="line">  <span class="comment">// By default gin.DefaultWriter = os.Stdout</span></span><br><span class="line">  r.Use(gin.Logger())</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Recovery middleware recovers from any panics and writes a 500 if there was one.</span></span><br><span class="line">  r.Use(gin.Recovery())</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Per route middleware, you can add as many as you desire.</span></span><br><span class="line">  r.GET(<span class="string">"/benchmark"</span>, MyBenchLogger(), benchEndpoint)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Authorization group</span></span><br><span class="line">  <span class="comment">// authorized := r.Group("/", AuthRequired())</span></span><br><span class="line">  <span class="comment">// exactly the same as:</span></span><br><span class="line">  authorized := r.Group(<span class="string">"/"</span>)</span><br><span class="line">  <span class="comment">// per group middleware! in this case we use the custom created</span></span><br><span class="line">  <span class="comment">// AuthRequired() middleware just in the "authorized" group.</span></span><br><span class="line">  authorized.Use(AuthRequired())</span><br><span class="line">  &#123;</span><br><span class="line">    authorized.POST(<span class="string">"/login"</span>, loginEndpoint)</span><br><span class="line">    authorized.POST(<span class="string">"/submit"</span>, submitEndpoint)</span><br><span class="line">    authorized.POST(<span class="string">"/read"</span>, readEndpoint)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// nested group</span></span><br><span class="line">    testing := authorized.Group(<span class="string">"testing"</span>)</span><br><span class="line">    testing.GET(<span class="string">"/analytics"</span>, analyticsEndpoint)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Listen and serve on 0.0.0.0:8080</span></span><br><span class="line">  r.Run(<span class="string">":8080"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Model-binding-and-validation"><a href="#Model-binding-and-validation" class="headerlink" title="Model binding and validation"></a>Model binding and validation</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Binding from JSON</span></span><br><span class="line"><span class="keyword">type</span> Login <span class="keyword">struct</span> &#123;</span><br><span class="line">  User     <span class="keyword">string</span> <span class="string">`form:"user" json:"user" xml:"user"  binding:"required"`</span></span><br><span class="line">  Password <span class="keyword">string</span> <span class="string">`form:"password" json:"password" xml:"password" binding:"required"`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  router := gin.Default()</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Example for binding JSON (&#123;"user": "manu", "password": "123"&#125;)</span></span><br><span class="line">  router.POST(<span class="string">"/loginJSON"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> json Login</span><br><span class="line">    <span class="keyword">if</span> err := c.ShouldBindJSON(&amp;json); err != <span class="literal">nil</span> &#123;</span><br><span class="line">      c.JSON(http.StatusBadRequest, gin.H&#123;<span class="string">"error"</span>: err.Error()&#125;)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> json.User != <span class="string">"manu"</span> || json.Password != <span class="string">"123"</span> &#123;</span><br><span class="line">      c.JSON(http.StatusUnauthorized, gin.H&#123;<span class="string">"status"</span>: <span class="string">"unauthorized"</span>&#125;)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125; </span><br><span class="line">    </span><br><span class="line">    c.JSON(http.StatusOK, gin.H&#123;<span class="string">"status"</span>: <span class="string">"you are logged in"</span>&#125;)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Example for binding XML (</span></span><br><span class="line">  <span class="comment">//  &lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line">  <span class="comment">//  &lt;root&gt;</span></span><br><span class="line">  <span class="comment">//    &lt;user&gt;user&lt;/user&gt;</span></span><br><span class="line">  <span class="comment">//    &lt;password&gt;123&lt;/user&gt;</span></span><br><span class="line">  <span class="comment">//  &lt;/root&gt;)</span></span><br><span class="line">  router.POST(<span class="string">"/loginXML"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> xml Login</span><br><span class="line">    <span class="keyword">if</span> err := c.ShouldBindXML(&amp;xml); err != <span class="literal">nil</span> &#123;</span><br><span class="line">      c.JSON(http.StatusBadRequest, gin.H&#123;<span class="string">"error"</span>: err.Error()&#125;)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> xml.User != <span class="string">"manu"</span> || xml.Password != <span class="string">"123"</span> &#123;</span><br><span class="line">      c.JSON(http.StatusUnauthorized, gin.H&#123;<span class="string">"status"</span>: <span class="string">"unauthorized"</span>&#125;)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125; </span><br><span class="line">    </span><br><span class="line">    c.JSON(http.StatusOK, gin.H&#123;<span class="string">"status"</span>: <span class="string">"you are logged in"</span>&#125;)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Example for binding a HTML form (user=manu&amp;password=123)</span></span><br><span class="line">  router.POST(<span class="string">"/loginForm"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> form Login</span><br><span class="line">    <span class="comment">// This will infer what binder to use depending on the content-type header.</span></span><br><span class="line">    <span class="keyword">if</span> err := c.ShouldBind(&amp;form); err != <span class="literal">nil</span> &#123;</span><br><span class="line">      c.JSON(http.StatusBadRequest, gin.H&#123;<span class="string">"error"</span>: err.Error()&#125;)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> form.User != <span class="string">"manu"</span> || form.Password != <span class="string">"123"</span> &#123;</span><br><span class="line">      c.JSON(http.StatusUnauthorized, gin.H&#123;<span class="string">"status"</span>: <span class="string">"unauthorized"</span>&#125;)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125; </span><br><span class="line">    </span><br><span class="line">    c.JSON(http.StatusOK, gin.H&#123;<span class="string">"status"</span>: <span class="string">"you are logged in"</span>&#125;)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Listen and serve on 0.0.0.0:8080</span></span><br><span class="line">  router.Run(<span class="string">":8080"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ curl -v -X POST \</span><br><span class="line">  http://localhost:8080/loginJSON \</span><br><span class="line">  -H <span class="string">'content-type: application/json'</span> \</span><br><span class="line">  -d <span class="string">'&#123; "user": "manu" &#125;'</span></span><br></pre></td></tr></table></figure>
<h3 id="params-summary"><a href="#params-summary" class="headerlink" title="params summary"></a>params summary</h3><p>参数解析方法:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// router.GET("/user/:name/*action", handlers ...HandlerFunc)</span></span><br><span class="line">name := c.Param(<span class="string">"name"</span>)</span><br><span class="line">action := c.Param(<span class="string">"action"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// req Url: /welcome?firstname=Jane&amp;lastname=Doe</span></span><br><span class="line">firstname := c.DefaultQuery(<span class="string">"firstname"</span>, <span class="string">"Guest"</span>)</span><br><span class="line">lastname := c.Query(<span class="string">"lastname"</span>) <span class="comment">// shortcut for c.Request.URL.Query().Get("lastname")</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// POST</span></span><br><span class="line">message := c.PostForm(<span class="string">"message"</span>)</span><br><span class="line">nick := c.DefaultPostForm(<span class="string">"nick"</span>, <span class="string">"anonymous"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 上传文件</span></span><br><span class="line">file, _ := c.FormFile(<span class="string">"file"</span>)</span><br><span class="line"><span class="comment">// 多文件上传</span></span><br><span class="line">form, _ := c.MultipartForm()</span><br><span class="line">files := form.File[<span class="string">"upload[]"</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义结构体</span></span><br><span class="line"><span class="keyword">type</span> Login <span class="keyword">struct</span> &#123;</span><br><span class="line">  User     <span class="keyword">string</span> <span class="string">`form:"user" json:"user" xml:"user"  binding:"required"`</span></span><br><span class="line">  Password <span class="keyword">string</span> <span class="string">`form:"password" json:"password" xml:"password" binding:"required"`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// bind JSON:  &#123;"user": "manu", "password": "123"&#125;</span></span><br><span class="line">c.ShouldBindJSON(&amp;json)</span><br><span class="line"><span class="comment">// bind XML:   </span></span><br><span class="line"><span class="comment">//  &lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="comment">//  &lt;root&gt;</span></span><br><span class="line"><span class="comment">//    &lt;user&gt;user&lt;/user&gt;</span></span><br><span class="line"><span class="comment">//    &lt;password&gt;123&lt;/user&gt;</span></span><br><span class="line"><span class="comment">//  &lt;/root&gt;</span></span><br><span class="line">c.ShouldBindXML(&amp;xml)</span><br><span class="line"><span class="comment">// bind form:  user=manu&amp;password=123</span></span><br><span class="line">c.ShouldBind(&amp;form)</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/08/29/backend/go/gin/gin_learn_start/" data-id="cjm60adsq002nxls6r6kzrgcq" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/gin/">gin</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/go/">go</a></li></ul>

    </footer>
  </div>
  
</article>
 


  
    <article id="post-backend/go/goose/goose_start_learn" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/08/29/backend/go/goose/goose_start_learn/" class="article-date">
  <time datetime="2018-08-29T12:12:00.000Z" itemprop="datePublished">2018-08-29</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/backend/">backend</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/08/29/backend/go/goose/goose_start_learn/">goose learn start</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- Table of Contents -->
        
        <h2 id="what-goose"><a href="#what-goose" class="headerlink" title="what goose"></a>what goose</h2><blockquote>
<p>goose is a database migration tool.<br>You can manage your database’s evolution by creating incremental SQL or Go scripts.</p>
</blockquote>
<h2 id="install"><a href="#install" class="headerlink" title="install"></a>install</h2><p>这个前提是需要安装 golang, 并会就 <code>goose</code> 命令生成到 <code>$GOPATH/bin</code> 目录下.<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> go get bitbucket.org/liamstask/goose/cmd/goose</span></span><br></pre></td></tr></table></figure></p>
<h2 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> goose</span></span><br><span class="line"></span><br><span class="line">goose is a database migration management system for Go projects.</span><br><span class="line"></span><br><span class="line">Usage:</span><br><span class="line">    goose [options] &lt;subcommand&gt; [subcommand options]</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  -env string</span><br><span class="line">    	which DB environment to use (default "development")</span><br><span class="line">  -path string</span><br><span class="line">    	folder containing db info (default "db")</span><br><span class="line">  -pgschema string</span><br><span class="line">    	which postgres-schema to migrate (default = none)</span><br><span class="line"></span><br><span class="line">Commands:</span><br><span class="line">    up         Migrate the DB to the most recent version available</span><br><span class="line">    down       Roll back the version by 1</span><br><span class="line">    redo       Re-run the latest migration</span><br><span class="line">    status     dump the migration status for the current DB</span><br><span class="line">    create     Create the scaffolding for a new migration</span><br><span class="line">    dbversion  Print the current version of the database</span><br></pre></td></tr></table></figure>
<h3 id="create"><a href="#create" class="headerlink" title="create"></a>create</h3><p>创建一个新的 migration , 这个创建的是 go migration<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">goose create AddSomeColumns</span><br></pre></td></tr></table></figure></p>
<p>如果是创建 sql migration 的话, 在后边加个 sql 即可.<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">goose create AddSomeColumns sql</span><br></pre></td></tr></table></figure></p>
<h3 id="up"><a href="#up" class="headerlink" title="up"></a>up</h3><p>应用所有可用的 migrations</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">goose up</span><br></pre></td></tr></table></figure>
<h3 id="down"><a href="#down" class="headerlink" title="down"></a>down</h3><p>从当前版本回滚单个 migrations<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">goose down</span><br></pre></td></tr></table></figure></p>
<h3 id="redo"><a href="#redo" class="headerlink" title="redo"></a>redo</h3><p>回滚最近应用的 migrations ，然后再次运行它。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">goose redo</span><br></pre></td></tr></table></figure>
<h3 id="status"><a href="#status" class="headerlink" title="status"></a>status</h3><p>打印所有 migrations 的状态：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">goose status</span><br></pre></td></tr></table></figure>
<h3 id="dbversion"><a href="#dbversion" class="headerlink" title="dbversion"></a>dbversion</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">goose dbversion</span><br></pre></td></tr></table></figure>
<h2 id="个人实验数据"><a href="#个人实验数据" class="headerlink" title="个人实验数据"></a>个人实验数据</h2><h3 id="配置如下"><a href="#配置如下" class="headerlink" title="配置如下:"></a>配置如下:</h3><p>目录结构:</p>
<p>jieLearn/<br>├── dbconf.yml<br>└── migrations<br>    ├── 20180829163647_jieTest.sql<br>    └── 20180829165529_addC4Col.sql</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> cat dbconf.yml</span></span><br><span class="line"></span><br><span class="line">development:</span><br><span class="line">    driver: mysql</span><br><span class="line">    open: root:password@tcp(127.0.0.1:3306)/jie_test?timeout=200ms&amp;parseTime=true&amp;loc=Local</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> cat jieLearn/migrations/20180829163647_jieTest.sql</span></span><br><span class="line"></span><br><span class="line">-- +goose Up</span><br><span class="line">-- SQL in section 'Up' is executed when this migration is applied</span><br><span class="line">CREATE TABLE `jie_test`.`test_table` (</span><br><span class="line">  `c1` INT NOT NULL,</span><br><span class="line">  `c2` VARCHAR(45) NULL,</span><br><span class="line">  `c3` VARCHAR(45) NULL,</span><br><span class="line">  PRIMARY KEY (`c1`));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-- +goose Down</span><br><span class="line">-- SQL section 'Down' is executed when this migration is rolled back</span><br><span class="line">DROP TABLE `jie_test`.`test_table`;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> cat jieLearn/migrations/20180829165529_addC4Col.sql</span></span><br><span class="line"></span><br><span class="line">-- +goose Up</span><br><span class="line">-- SQL in section 'Up' is executed when this migration is applied</span><br><span class="line">ALTER TABLE `jie_test`.`test_table`</span><br><span class="line">ADD COLUMN `c4` VARCHAR(45) NULL AFTER `c3`;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-- +goose Down</span><br><span class="line">-- SQL section 'Down' is executed when this migration is rolled back</span><br><span class="line">ALTER TABLE `jie_test`.`test_table`</span><br><span class="line">DROP COLUMN `c4`;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> goose -path <span class="string">"jieLearn"</span> up</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> goose -path <span class="string">"jieLearn"</span> down</span></span><br></pre></td></tr></table></figure>
<h3 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h3><p>new table: goose_db_version, test_table</p>
<p>goose_db_version: content<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1	0	1	2018-08-29 08:33:23</span><br><span class="line">2	20180829163647	1	2018-08-29 08:33:23</span><br><span class="line">3	20180829163647	0	2018-08-29 08:34:53</span><br><span class="line">4	20180829163647	1	2018-08-29 08:35:35</span><br><span class="line">5	20180829165529	1	2018-08-29 08:42:39</span><br><span class="line">6	20180829165529	0	2018-08-29 08:43:00</span><br></pre></td></tr></table></figure></p>
<p>参考: <a href="https://bitbucket.org/liamstask/goose" target="_blank" rel="noopener">https://bitbucket.org/liamstask/goose</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/08/29/backend/go/goose/goose_start_learn/" data-id="cjm60adso002kxls6gcdig53u" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/go/">go</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/goose/">goose</a></li></ul>

    </footer>
  </div>
  
</article>
 


  
    <article id="post-build_own_x/data_base/build_simple_database/p1_introduction_and_setting_up_the_REPL" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/05/17/build_own_x/data_base/build_simple_database/p1_introduction_and_setting_up_the_REPL/" class="article-date">
  <time datetime="2018-05-17T11:59:57.000Z" itemprop="datePublished">2018-05-17</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/build-own-x/">build-own-x</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/05/17/build_own_x/data_base/build_simple_database/p1_introduction_and_setting_up_the_REPL/">Build a Simple Database - Introduction and Setting up the REPL</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- Table of Contents -->
        
        <h1 id="Part-1-Introduction-and-Setting-up-the-REPL"><a href="#Part-1-Introduction-and-Setting-up-the-REPL" class="headerlink" title="Part 1 - Introduction and Setting up the REPL"></a>Part 1 - Introduction and Setting up the REPL</h1><h1 id="Sqlite"><a href="#Sqlite" class="headerlink" title="Sqlite"></a>Sqlite</h1><p>There’s lots of <a href="https://www.sqlite.org/arch.html" target="_blank" rel="noopener">documentation of sqlite internals</a> on their website, plus I’ve got a copy of <a href="https://play.google.com/store/books/details?id=9Z6IQQnX1JEC" target="_blank" rel="noopener">SQLite Database System: Design and Implementation</a>.</p>
<p> <img src="https://cstack.github.io/db_tutorial/assets/images/arch1.gif" alt="https://cstack.github.io/db_tutorial/assets/images/arch1.gif"></p>
<p>sqlite architecture (<a href="https://www.sqlite.org/zipvfs/doc/trunk/www/howitworks.wiki" target="_blank" rel="noopener">https://www.sqlite.org/zipvfs/doc/trunk/www/howitworks.wiki</a>)</p>
<p>分成前后端:</p>
<p>前端部分:</p>
<ul>
<li>tokenizer</li>
<li>parser</li>
<li>code generator</li>
</ul>
<p>后端部分:</p>
<ul>
<li>virtual machine</li>
<li>B-tree</li>
<li>pager</li>
<li>os interface</li>
</ul>
<p><a href="https://en.wiktionary.org/wiki/a_journey_of_a_thousand_miles_begins_with_a_single_step" target="_blank" rel="noopener">A journey of a thousand miles begins with a single step(千里之行始于足下)</a>, so let’s start with something a little more straightforward: the REPL.</p>
<p><strong>REPL:</strong> <em>read-execute-print</em></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">~ sqlite3</span><br><span class="line">SQLite version <span class="number">3.16</span><span class="number">.0</span> <span class="number">2016</span><span class="number">-11</span><span class="number">-04</span> <span class="number">19</span>:<span class="number">09</span>:<span class="number">39</span></span><br><span class="line">Enter <span class="string">".help"</span> <span class="keyword">for</span> usage hints.</span><br><span class="line">Connected to a transient in-memory database.</span><br><span class="line">Use <span class="string">".open FILENAME"</span> to reopen on a persistent database.</span><br><span class="line">sqlite&gt; create table users (id int, username varchar(255), email varchar(255));</span><br><span class="line">sqlite&gt; .tables</span><br><span class="line">users</span><br><span class="line">sqlite&gt; .<span class="built_in">exit</span></span><br><span class="line">~</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/05/17/build_own_x/data_base/build_simple_database/p1_introduction_and_setting_up_the_REPL/" data-id="cjm60adt0002vxls6dhuh7us1" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/database/">database</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/db原理/">db原理</a></li></ul>

    </footer>
  </div>
  
</article>
 


  
    <article id="post-build_own_x/data_base/build_simple_database/模块功能概述" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/05/17/build_own_x/data_base/build_simple_database/模块功能概述/" class="article-date">
  <time datetime="2018-05-17T11:59:57.000Z" itemprop="datePublished">2018-05-17</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/build-own-x/">build-own-x</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/05/17/build_own_x/data_base/build_simple_database/模块功能概述/">Build a Simple Database - 模块功能概述</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- Table of Contents -->
        
        <p><img src="https://cstack.github.io/db_tutorial/assets/images/arch2.gif" alt="https://cstack.github.io/db_tutorial/assets/images/arch2.gif"></p>
<p>sqlite architecture (<a href="https://www.sqlite.org/arch.html" target="_blank" rel="noopener">https://www.sqlite.org/arch.html</a>)</p>
<p>小结:</p>
<p>core: 主要的构成模块: interface, sqlCommand Processor, Virtual Machine</p>
<p>SQL Compiler: Tokenizer, Parser, Code Generator</p>
<p>Backend: B-Tree, Pager, OS Interface</p>
<p>翻译:(<a href="https://www.sqlite.org/arch.html" target="_blank" rel="noopener">https://www.sqlite.org/arch.html</a>)</p>
<h3 id="概览"><a href="#概览" class="headerlink" title="概览"></a>概览</h3><p>SQLite的工作原理是将SQL文本编译为<a href="https://www.sqlite.org/opcode.html" target="_blank" rel="noopener">字节码</a>，然后使用虚拟机运行该字节码。</p>
<p>sqlite3_prepare_v2（）和相关接口充当用于将SQL文本转换为字节码的编译器。 sqlite3_stmt对象是用于实现单个SQL语句的单个字节码程序的容器。 sqlite3_step（）接口将一个字节码程序传递给虚拟机，并运行该程序直到它完成，或者形成一行结果返回，或者发生致命错误或中断。</p>
<h3 id="Interface"><a href="#Interface" class="headerlink" title="Interface"></a>Interface</h3><p>许多C语言接口可以在源文件main.c，legacy.c和vdbeapi.c中找到，尽管一些例程分散在其他文件中，在这些文件中它们可以访问具有文件范围的数据结构。sqlite3_get_table（）例程在table.c中实现。 sqlite3_mprintf（）例程在printf.c中找到。 sqlite3_complete（）接口位于tokenize.c中。 TCL接口由tclsqlite.c实现。</p>
<p>为避免名称冲突，SQLite库中的所有外部符号都以前缀sqlite3开头。那些用于外部使用的符号（换句话说，那些构成SQLite API的符号）会添加一个下划线，因此以sqlite3_开头。扩展API有时会在下划线之前添加扩展名;例如：sqlite3rbu_或sqlite3session_。</p>
<h3 id="Tokenizer"><a href="#Tokenizer" class="headerlink" title="Tokenizer"></a>Tokenizer</h3><p>当包含SQL语句的字符串要被评估时，它首先被发送到标记器。标记器将SQL文本分解为标记并将这些标记逐个传递给解析器。标记器是在文件tokenize.c中手动编码的</p>
<p>请注意，在此设计中，标记器调用解析器。熟悉YACC和BISON的人可能习惯于以相反的方式做事 - 让解析器调用标记器。不过，令牌分析器调用分析器会更好，因为它可以做成线程安全的并且运行速度更快。</p>
<h3 id="Parser"><a href="#Parser" class="headerlink" title="Parser"></a>Parser</h3><p>解析器根据其上下文为令牌分配含义。 SQLite的解析器是使用Lemon解析器生成器生成的。Lemon和YACC / BISON一样工作，但它使用了不太容易出错的不同输入语法。Lemon还生成一个可重入且线程安全的解析器。Lemon定义了非终端析构函数的概念，以便在遇到语法错误时不会泄漏内存。驱动Lemon并定义SQLite可理解的SQL语言的语法文件可在parse.y中找到。</p>
<p>因为Lemon是一个通常在开发机器上找不到的程序，Lemon的完整源代码（只有一个C文件）包含在SQLite分发的“tool”子目录中。</p>
<h3 id="Code-Generator"><a href="#Code-Generator" class="headerlink" title="Code Generator"></a>Code Generator</h3><p>解析器将令牌组装成解析树之后，代码生成器运行以分析解析器树并生成执行SQL语句工作的字节码。准备好的语句对象是这个字节码的容器。代码生成器中有许多文件，其中包括：attach.c，auth.c，build.c，delete.c，expr.c，insert.c，pragma.c，select.c，trigger.c，update.c ，vacuum.c，where.c，wherecode.c和whereexpr.c。在这些文件中，大部分严重的魔法都是在这里发生的。 expr.c处理表达式的代码生成。其中* .c处理SELECT，UPDATE和DELETE语句中WHERE子句的代码生成。文件attach.c，delete.c，insert.c，select.c，trigger.c update.c和vacuum.c处理具有相同名称的SQL语句的代码生成。 （这些文件中的每一个都根据需要调用expr.c和where.c中的例程。）所有其他SQL语句都由build.c编码。 auth.c文件实现sqlite3_set_authorizer（）的功能</p>
<p>代码生成器，特别是* .c和select.c中的逻辑有时称为查询规划器。对于任何特定的SQL语句，可能有数百，数千或数百万种不同的算法来计算答案。查询计划员是一个AI，致力于从数百万个选择中选择最佳算法。</p>
<h3 id="Bytecode-Engine"><a href="#Bytecode-Engine" class="headerlink" title="Bytecode Engine"></a>Bytecode Engine</h3><p>由代码生成器创建的字节码程序由虚拟机运行。</p>
<p>虚拟机本身完全包含在单个源文件vdbe.c中。 vdbe.h头文件定义了虚拟机和SQLite库的其余部分之间的接口，vdbeInt.h定义了虚拟机本身专用的结构和接口。其他各种vdbe * .c文件都是虚拟机的助手。 vdbeaux.c文件包含虚拟机使用的实用程序以及库的其余部分用于构建VM程序的接口模块。 vdbeapi.c文件包含虚拟机的外部接口，如sqlite3_bind_int（）和sqlite3_step（）。各个值（字符串，整数，浮点数和BLOB）存储在由vdbemem.c实现的名为“Mem”的内部对象中。</p>
<p>SQLite使用C语言例程的回调来实现SQL函数。即使内置的SQL函数也是这样实现的。大多数内置的SQL函数（例如：abs（），count（），substr（）等）都可以在func.c源文件中找到。日期和时间转换函数可在date.c中找到。一些函数如coalesce（）和typeof（）直接由代码生成器实现为字节码。</p>
<h3 id="B-Tree"><a href="#B-Tree" class="headerlink" title="B-Tree"></a>B-Tree</h3><p>SQLite数据库使用btree.c源文件中的B-tree实现在磁盘上进行维护。数据库中的每个表和索引都使用单独的B树。所有B树都存储在同一个磁盘文件中。文件格式细节稳定且定义明确，并保证向前兼容。</p>
<p>B树子系统和SQLite库的其余部分的接口由头文件btree.h定义。</p>
<h3 id="Page-Cache"><a href="#Page-Cache" class="headerlink" title="Page Cache"></a>Page Cache</h3><p>B树模块以固定大小的页面从磁盘请求信息。默认的page_size是4096字节，但可以是512到65536字节之间的任意两个幂。页面缓存负责读取，写入和缓存这些页面。页面缓存还提供了回滚和原子提交抽象，并负责锁定数据库文件。 B树驱动程序请求页面缓存中的特定页面，并在需要修改页面或提交或回滚更改时通知页面缓存。页面缓存处理了确保请求被快速，安全和有效地处理的所有细节.</p>
<p>主页面缓存实现在pager.c文件中。 WAL模式逻辑位于单独的wal.c中。内存中缓存由pcache.c和pcache1.c文件实现。页面缓存子系统和SQLite其余部分之间的接口由头文件pager.h定义。</p>
<p>###OS Interface</p>
<p>为了提供跨操作系统的可移植性，SQLite使用称为VFS的抽象对象。每个VFS都提供了打开，读取，写入和关闭磁盘上的文件以及执行其他特定于操作系统的任务（如查找当前时间或获取随机性以初始化内置伪随机数生成器的方法）。 SQLite当前为unix（在os_unix.c文件中）和Windows（在os_win.c文件中）提供了VFSes。</p>
<h3 id="Utilities"><a href="#Utilities" class="headerlink" title="Utilities"></a>Utilities</h3><p>内存分配，无格式字符串比较例程，便携式文本到数字转换例程以及其他实用程序位于util.c中。解析器使用的符号表由散列表中的哈希表维护。 utf.c源文件包含Unicode转换子例程。 SQLite在printf.c中有它自己的printf（）（有一些扩展）的私有实现，在random.c中有它自己的伪随机数生成器（PRNG）。</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结:"></a>总结:</h3><p>sqlite(数据库)将数据持久化,并将其做到了极致吧.(引人深思)</p>
<p>整体结构, 主要分成三部分: 1. core, 2. SQL Compiler, 3. Backend</p>
<p>其主要流程也相当清晰:</p>
<p>   interface -&gt; sqlCommand Processor -&gt; Virtual Machine</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/05/17/build_own_x/data_base/build_simple_database/模块功能概述/" data-id="cjm60adt2002zxls6rcyz319g" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/database/">database</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/db原理/">db原理</a></li></ul>

    </footer>
  </div>
  
</article>
 


  
    <article id="post-alg/sorting/Dual_pivot_Quicksort" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/04/27/alg/sorting/Dual_pivot_Quicksort/" class="article-date">
  <time datetime="2018-04-27T06:55:52.000Z" itemprop="datePublished">2018-04-27</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/alg/">alg</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/04/27/alg/sorting/Dual_pivot_Quicksort/">Dual pivot Quicksort</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- Table of Contents -->
        
        <p>time: 2018-04-27 14:55:52</p>
<p>参考：<a href="https://www.geeksforgeeks.org/dual-pivot-quicksort/" target="_blank" rel="noopener">https://www.geeksforgeeks.org/dual-pivot-quicksort/</a></p>
<blockquote>
<p>  The idea of dual pivot quick sort is to take two pivots, one in the left end of the array and the second, in the right end of the array. The left pivot must be less than or equal to the right pivot, so we swap them if necessary.</p>
<p>  Then, we begin partitioning the array into three parts: in the first part, all elements will be less than the left pivot, in the second part all elements will be greater or equal to the left pivot and also will be less than or equal to the right pivot, and in the third part all elements will be greater than the right pivot. Then, we shift the two pivots to their appropriate positions as we see in the below bar, and after that we begin quicksorting these three parts recursively, using this method.</p>
<p>  Dual pivot quick sort is a little bit faster than the original single pivot quicksort.But still, the worst case will remain O(n^2) when the array is already sorted in an increasing or decreasing order.</p>
</blockquote>
<p><img src="http://contribute.geeksforgeeks.org/wp-content/uploads/dual.png" alt="An example"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// C program to implement dual pivot QuickSort</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">partition</span><span class="params">(<span class="keyword">int</span>* arr, <span class="keyword">int</span> low, <span class="keyword">int</span> high, <span class="keyword">int</span>* lp)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">swap</span><span class="params">(<span class="keyword">int</span>* a, <span class="keyword">int</span>* b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> temp = *a;</span><br><span class="line">	*a = *b;</span><br><span class="line">	*b = temp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DualPivotQuickSort</span><span class="params">(<span class="keyword">int</span>* arr, <span class="keyword">int</span> low, <span class="keyword">int</span> high)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (low &lt; high) &#123;</span><br><span class="line">		<span class="comment">// lp means left pivot, and rp means right pivot.</span></span><br><span class="line">		<span class="keyword">int</span> lp, rp; </span><br><span class="line">		rp = partition(arr, low, high, &amp;lp);</span><br><span class="line">		DualPivotQuickSort(arr, low, lp - <span class="number">1</span>);</span><br><span class="line">		DualPivotQuickSort(arr, lp + <span class="number">1</span>, rp - <span class="number">1</span>);</span><br><span class="line">		DualPivotQuickSort(arr, rp + <span class="number">1</span>, high);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">partition</span><span class="params">(<span class="keyword">int</span>* arr, <span class="keyword">int</span> low, <span class="keyword">int</span> high, <span class="keyword">int</span>* lp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"------- begin partition --------\n"</span>);</span><br><span class="line">	<span class="keyword">if</span> (arr[low] &gt; arr[high])</span><br><span class="line">		swap(&amp;arr[low], &amp;arr[high]);</span><br><span class="line">	<span class="comment">// p is the left pivot, and q is the right pivot.</span></span><br><span class="line">	<span class="keyword">int</span> j = low + <span class="number">1</span>,g = high - <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">int</span> k = low + <span class="number">1</span>, p = arr[low], q = arr[high];</span><br><span class="line">	<span class="keyword">while</span> (k &lt;= g) &#123;</span><br><span class="line">	    <span class="built_in">printf</span>(<span class="string">"j: %d value: %d, g: %d value: %d, k: %d value: %d\n"</span>, j, arr[j], g, arr[g], k, arr[k]);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// if elements are less than the left pivot</span></span><br><span class="line">		<span class="keyword">if</span> (arr[k] &lt; p) &#123;</span><br><span class="line">			swap(&amp;arr[k], &amp;arr[j]);</span><br><span class="line">			j++;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// if elements are greater than or equal </span></span><br><span class="line">		<span class="comment">// to the right pivot</span></span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (arr[k] &gt;= q) &#123;</span><br><span class="line">			<span class="keyword">while</span> (arr[g] &gt; q &amp;&amp; k &lt; g)</span><br><span class="line">				g--;</span><br><span class="line">			swap(&amp;arr[k], &amp;arr[g]);</span><br><span class="line">			g--;</span><br><span class="line">			<span class="keyword">if</span> (arr[k] &lt; p) &#123;</span><br><span class="line">				swap(&amp;arr[k], &amp;arr[j]);</span><br><span class="line">				j++;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		k++;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++)</span><br><span class="line">		    <span class="built_in">printf</span>(<span class="string">"%d "</span>, arr[i]);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	j--;</span><br><span class="line">	g++;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// bring pivots to their appropriate positions.</span></span><br><span class="line">	swap(&amp;arr[low], &amp;arr[j]);</span><br><span class="line">	swap(&amp;arr[high], &amp;arr[g]);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// returning the indeces of the pivots.</span></span><br><span class="line">	*lp = j; <span class="comment">// because we cannot return two elements </span></span><br><span class="line">			<span class="comment">// from a function.</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"------- end partition --------\n"</span>);</span><br><span class="line">	<span class="keyword">return</span> g;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Driver code</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> arr[] = &#123; <span class="number">24</span>, <span class="number">8</span>, <span class="number">42</span>, <span class="number">75</span>, <span class="number">29</span>, <span class="number">77</span>, <span class="number">38</span>, <span class="number">57</span> &#125;;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"24, 8, 42, 75, 29, 77, 38, 57\n"</span>);</span><br><span class="line">	DualPivotQuickSort(arr, <span class="number">0</span>, <span class="number">7</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"Sorted array: "</span>);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++)</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"%d "</span>, arr[i]);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">24, 8, 42, 75, 29, 77, 38, 57</span><br><span class="line">------- begin partition --------</span><br><span class="line">j: 1 value: 8, g: 6 value: 38, k: 1 value: 8</span><br><span class="line">24 8 42 75 29 77 38 57 </span><br><span class="line">j: 2 value: 42, g: 6 value: 38, k: 2 value: 42</span><br><span class="line">24 8 42 75 29 77 38 57 </span><br><span class="line">j: 2 value: 42, g: 6 value: 38, k: 3 value: 75</span><br><span class="line">24 8 42 38 29 77 75 57 </span><br><span class="line">j: 2 value: 42, g: 5 value: 77, k: 4 value: 29</span><br><span class="line">24 8 42 38 29 77 75 57 </span><br><span class="line">j: 2 value: 42, g: 5 value: 77, k: 5 value: 77</span><br><span class="line">24 8 42 38 29 77 75 57 </span><br><span class="line">------- end partition --------</span><br><span class="line">------- begin partition --------</span><br><span class="line">j: 3 value: 38, g: 3 value: 38, k: 3 value: 38</span><br><span class="line">8 24 29 38 42 57 75 77 </span><br><span class="line">------- end partition --------</span><br><span class="line">------- begin partition --------</span><br><span class="line">------- end partition --------</span><br><span class="line">Sorted array: 8 24 29 38 42 57 75 77</span><br></pre></td></tr></table></figure>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>基本的处理流程：</p>
<ol>
<li><p>选定最低位和最高位作为轴 num，也就是有两个轴。</p>
</li>
<li><p>lowPoint = low + 1 和 highPoint = high - 1 作为选轴的开始点。</p>
</li>
<li><p>scanPoint = lowPoint 一直扫描到 highPoint， 如果 scanPoint_Value &lt; low_Value : swap(lowPoint_Value, scanPoint_Value) elseif (scanPoint_Value &gt;= high_Value) : swap(highPoint_Value, scanPoint_Value)</p>
</li>
<li><p>最后 swap(low_Value, (lowPoint - 1).Value), swap(high_Value, (highPoint + 1)_Value)</p>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/04/27/alg/sorting/Dual_pivot_Quicksort/" data-id="cjm60ads80012xls6comoyjlf" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/sorting/">sorting</a></li></ul>

    </footer>
  </div>
  
</article>
 


  


  <nav id="page-nav">
    <a class="extend prev" rel="prev" href="/page/2/">&laquo; 上一页</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span>
  </nav>
</section>
           
    <aside id="sidebar">
  
    

  
    
  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title recent-posts">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2018/09/14/backend/go/grpc/服务的注册_发现/">服务的注册,发现</a>
          </li>
        
          <li>
            <a href="/2018/09/08/frontend/learn_admin_manage/admin_manage_jie_learn/">admin_manage_jie</a>
          </li>
        
          <li>
            <a href="/2018/09/04/self_doc/个人软件安装记录-linux/">个人软件安装记录(linux-ubuntu)</a>
          </li>
        
          <li>
            <a href="/2018/09/02/frontend/css/grid_learn/learn_css_grid/">Learn CSS Grid</a>
          </li>
        
          <li>
            <a href="/2018/09/01/backend/tools/markfile_start_learn/">markfile start learn</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    

  
    
  
</aside>

      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-left">
      &copy; 2014 - 2018 jie&nbsp;|&nbsp;
      主题 <a href="https://github.com/giscafer/hexo-theme-cafe/" target="_blank">Cafe</a>
    </div>
     <div id="footer-right">
      联系方式&nbsp;|&nbsp;qq646958863@163.com
    </div>
  </div>
</footer>
 <script src="/jquery/jquery.min.js"></script>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">首页</a>
  
    <a href="/archives" class="mobile-nav-link">归档</a>
  
    <a href="/about" class="mobile-nav-link">关于</a>
  
</nav>
    <img class="back-to-top-btn" src="/images/fly-to-top.png"/>
<script>
// Elevator script included on the page, already.
window.onload = function() {
  var elevator = new Elevator({
    selector:'.back-to-top-btn',
    element: document.querySelector('.back-to-top-btn'),
    duration: 1000 // milliseconds
  });
}
</script>
      

  

  







<!-- author:forvoid begin -->
<!-- author:forvoid begin -->

<!-- author:forvoid end -->

<!-- author:forvoid end -->


  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      })
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      })
    </script>
    <script type="text/javascript" src="https://cdn.rawgit.com/mathjax/MathJax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


 <script src="/js/is.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>
<script src="/js/elevator.js"></script>
  </div>
</body>
</html>