<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  
  <title>Zombie T3 | Jie-Think</title>
  <meta name="description" content="jie blog" />
  <meta name="keywords" content="" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <link rel="shortcut icon" href="/">
  <link rel="alternate" href="/atom.xml" title="Jie-Think">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="涉及内容：智能协议的所有权，Gas的花费，代码优化，和代码安全 ch1. 智能协议的永固性在你把智能协议传上以太坊之后，它就变得不可更改, 这种永固性意味着你的代码永远不能被调整或更新。 尽量不要写死代码 ch2. Ownable ContractsOpenZeppelin库的Ownable 合约：OpenZeppelin 是主打安保和社区审查的智能合约库，您可以在自己的 DApps中引用。 12">
<meta name="keywords" content="blockchain,智能合约">
<meta property="og:type" content="article">
<meta property="og:title" content="Zombie T3">
<meta property="og:url" content="http://yoursite.com/2018/08/29/block_chain/contractLearn/Zombie_Con_Ch3/index.html">
<meta property="og:site_name" content="Jie-Think">
<meta property="og:description" content="涉及内容：智能协议的所有权，Gas的花费，代码优化，和代码安全 ch1. 智能协议的永固性在你把智能协议传上以太坊之后，它就变得不可更改, 这种永固性意味着你的代码永远不能被调整或更新。 尽量不要写死代码 ch2. Ownable ContractsOpenZeppelin库的Ownable 合约：OpenZeppelin 是主打安保和社区审查的智能合约库，您可以在自己的 DApps中引用。 12">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2018-08-29T13:23:37.173Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Zombie T3">
<meta name="twitter:description" content="涉及内容：智能协议的所有权，Gas的花费，代码优化，和代码安全 ch1. 智能协议的永固性在你把智能协议传上以太坊之后，它就变得不可更改, 这种永固性意味着你的代码永远不能被调整或更新。 尽量不要写死代码 ch2. Ownable ContractsOpenZeppelin库的Ownable 合约：OpenZeppelin 是主打安保和社区审查的智能合约库，您可以在自己的 DApps中引用。 12">

  <link rel="shortcut icon" href="" />
  <link rel="icon" href="" />
  <link href="https://fonts.googleapis.com/css?family=Ubuntu" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Inconsolata|Titillium+Web" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Roboto+Mono" rel="stylesheet">
  <link href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <link href='//cdn.bootcss.com/node-waves/0.7.5/waves.min.css' rel='stylesheet'>
  <link rel="stylesheet" href="/style.css">
  <script>
    function setLoadingBarProgress(num) {
      document.getElementById('loading-bar').style.width=num+"%";
    }
  </script>
</head>

<body>
  <div id="loading-bar-wrapper">
  <div id="loading-bar"></div>
</div>


  <script>setLoadingBarProgress(20)</script>
  <header class="l_header">
	<div class='wrapper'>
		<div class="nav-main container container--flex">
			<a class="logo flat-box" href='/' >
				<!-- <i class="fa fa-home"></i> -->
				Jie-Think
			</a>

				<div class='menu'>
					<ul class='h-list'>
						
							<li>
								<a class='flat-box nav-about' href='/'>
									<i class="fa fa-home fa-fw"></i>
									主页
								</a>
							</li>
						
							<li>
								<a class='flat-box nav-projects' href='https://github.com/jie-think'>
									<i class="fa fa-cube fa-fw"></i>
									项目
								</a>
							</li>
						
							<li>
								<a class='flat-box nav-archives' href='/archives'>
									<i class="fa fa-archive fa-fw"></i>
									归档
								</a>
							</li>
						
					</ul>
					<div class='underline'></div>
				</div>

			
				<div class="m_search">
					<form name="searchform" class="form u-search-form">
						<input type="text" class="input u-search-input" placeholder="Search" />
						<span class="icon"><i class="fa fa-search fa-fw"></i></span>
					</form>
				</div>
			
			<ul class='switcher h-list'>
				
					<li class='s-search'><a href='javascript:void(0)'><i class="fa fa-search fa-fw"></i></span></a></li>
				
				<li class='s-menu'><a href='javascript:void(0)'><i class="fa fa-navicon fa-fw"></i></a></li>
			</ul>
		</div>

		<div class='nav-sub container container--flex'>
			<a class="logo" class="flat-box" href='javascript:void(0)'>
				xaoxuu
			</a>

			<ul class='switcher h-list'>
				<li class='s-comment'><a href='javascript:void(0)'><i class="fa fa-comments fa-fw"></i></a></li>
				<li class='s-top'><a href='javascript:void(0)'><i class="fa fa-arrow-up fa-fw"></i></a></li>
				<li class='s-toc'><a href='javascript:void(0)'><i class="fa fa-list-ul fa-fw"></i></a></li>
			</ul>
		</div>
	</div>
</header>
	<aside class="menu-phone">
        <div class="header">Jie-Think</div>
		<nav>
			
				<a href="/" class="nav-about nav">
					<i class="fa fa-home"></i>
					主页
				</a>
			
				<a href="https://github.com/jie-think" class="nav-projects nav">
					<i class="fa fa-cube"></i>
					项目
				</a>
			
				<a href="/archives" class="nav-archives nav">
					<i class="fa fa-archive"></i>
					归档
				</a>
			
		</nav>
	</aside>

    <script>setLoadingBarProgress(40);</script>
  <div class="l_body">
    <div class='container clearfix'>
      <div class='l_main'>
        <article id="post-block_chain/contractLearn/Zombie_Con_Ch3" class="post white-box article-type-post" itemscope itemprop="blogPost">
    <section class='meta'>
        <h1 class="title">
            
                Zombie T3
            
        </h1>
        <time>
            2018-08-29 Wednesday&nbsp;&nbsp;
            <i class="fa fa-eye fa-fw" aria-hidden="true"></i>&nbsp;<span id="busuanzi_value_page_pv"><i class="fa fa-spinner fa-spin fa-fw" aria-hidden="true"></i></span>
        </time>
        
    
    <div class='cats'>
        <a href="/categories/backend/">backend</a>
    </div>


    </section>

    <section class="article typo">

        <div class="article-entry" itemprop="articleBody">
            <p>涉及内容：<code>智能协议的所有权</code>，<code>Gas的花费</code>，<code>代码优化</code>，和<code>代码安全</code></p>
<h2 id="ch1-智能协议的永固性"><a href="#ch1-智能协议的永固性" class="headerlink" title="ch1. 智能协议的永固性"></a>ch1. 智能协议的永固性</h2><p>在你把智能协议传上以太坊之后，它就变得<code>不可更改</code>, 这种永固性意味着你的代码永远不能被调整或更新。</p>
<p><strong>尽量不要写死代码</strong></p>
<h2 id="ch2-Ownable-Contracts"><a href="#ch2-Ownable-Contracts" class="headerlink" title="ch2. Ownable Contracts"></a>ch2. Ownable Contracts</h2><p>OpenZeppelin库的Ownable 合约：OpenZeppelin 是主打安保和社区审查的智能合约库，您可以在自己的 DApps中引用。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * @title Ownable</span><br><span class="line"> * @dev The Ownable contract has an owner address, and provides basic authorization control</span><br><span class="line"> * functions, this simplifies the implementation of &quot;user permissions&quot;.</span><br><span class="line"> */</span><br><span class="line">contract Ownable &#123;</span><br><span class="line">  address public owner;</span><br><span class="line">  event OwnershipTransferred(address indexed previousOwner, address indexed newOwner);</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * @dev The Ownable constructor sets the original `owner` of the contract to the sender</span><br><span class="line">   * account.</span><br><span class="line">   */</span><br><span class="line">  function Ownable() public &#123;</span><br><span class="line">    owner = msg.sender;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * @dev Throws if called by any account other than the owner.</span><br><span class="line">   */</span><br><span class="line">  modifier onlyOwner() &#123;</span><br><span class="line">    require(msg.sender == owner);</span><br><span class="line">    _;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * @dev Allows the current owner to transfer control of the contract to a newOwner.</span><br><span class="line">   * @param newOwner The address to transfer ownership to.</span><br><span class="line">   */</span><br><span class="line">  function transferOwnership(address newOwner) public onlyOwner &#123;</span><br><span class="line">    require(newOwner != address(0));</span><br><span class="line">    OwnershipTransferred(owner, newOwner);</span><br><span class="line">    owner = newOwner;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>构造函数: <code>function Ownable()</code> 是一个 constructor (构造函数)，构造函数不是必须的，它与合约同名，构造函数一生中唯一的一次执行，就是在合约最初被创建的时候。</p>
</li>
<li><p>函数修饰符：<code>modifier onlyOwner()</code> 修饰符跟函数很类似，不过是用来修饰其他已有函数用的， 在其他语句执行前，为它检查下先验条件。<code>_;</code> 类似于 ruby 中的 <code>yield</code></p>
</li>
</ul>
<p>所以<code>Ownable</code>合约基本都会这么干：</p>
<ol>
<li>合约创建，构造函数先行，将其 owner 设置为msg.sender（其部署者）</li>
<li>为它加上一个修饰符 onlyOwner，它会限制陌生人的访问，将访问某些函数的权限锁定在 owner 上。</li>
<li>允许将合约所有权转让给他人。</li>
</ol>
<h2 id="ch4-Gas"><a href="#ch4-Gas" class="headerlink" title="ch4. Gas"></a>ch4. Gas</h2><p><strong>重要概念：</strong> <code>Gas - 驱动以太坊DApps的能源</code></p>
<p>在 Solidity 中，你的用户想要每次执行你的 DApp 都需要支付一定的 gas，gas 可以用以太币购买，因此，用户每次跑 DApp 都得花费以太币。</p>
<p>一个 DApp 收取多少 gas 取决于功能逻辑的复杂程度。每个操作背后，都在计算完成这个操作所需要的计算资源，（比如，存储数据就比做个加法运算贵得多）， 一次操作所需要花费的 gas 等于这个操作背后的所有运算花销的总和。</p>
<p>由于运行你的程序需要花费用户的真金白银，在以太坊中代码的编程语言，比其他任何编程语言都更强调优化。同样的功能，使用笨拙的代码开发的程序，比起经过精巧优化的代码来，运行花费更高，这显然会给成千上万的用户带来大量不必要的开销。</p>
<h3 id="为什么要用-gas-来驱动？"><a href="#为什么要用-gas-来驱动？" class="headerlink" title="为什么要用 gas 来驱动？"></a>为什么要用 gas 来驱动？</h3><p>以太坊就像一个巨大、缓慢、但非常安全的电脑。当你运行一个程序的时候，网络上的每一个节点都在进行相同的运算，以验证它的输出 —— 这就是所谓的”去中心化“ 由于数以千计的节点同时在验证着每个功能的运行，这可以确保它的数据不会被被监控，或者被刻意修改。</p>
<p>可能会有用户用无限循环堵塞网络，抑或用密集运算来占用大量的网络资源，为了防止这种事情的发生，以太坊的创建者为以太坊上的资源制定了价格，想要在以太坊上运算或者存储，你需要先付费。</p>
<h3 id="省-gas-的招数：结构封装-（Struct-packing）"><a href="#省-gas-的招数：结构封装-（Struct-packing）" class="headerlink" title="省 gas 的招数：结构封装 （Struct packing）"></a>省 gas 的招数：结构封装 （Struct packing）</h3><p>在第1课中，我们提到除了基本版的 uint 外，还有其他变种 uint：uint8，uint16，uint32等。</p>
<p>通常情况下我们不会考虑使用 unit 变种，因为无论如何定义 uint的大小，Solidity 为它保留256位的存储空间。例如，使用 uint8 而不是uint（uint256）不会为你节省任何 gas。</p>
<p>除非，把 unit 绑定到 struct 里面。</p>
<p>如果一个 struct 中有多个 uint，则尽可能使用较小的 uint, Solidity 会将这些 uint 打包在一起，从而占用较少的存储空间。例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">struct NormalStruct &#123;</span><br><span class="line">  uint a;</span><br><span class="line">  uint b;</span><br><span class="line">  uint c;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">struct MiniMe &#123;</span><br><span class="line">  uint32 a;</span><br><span class="line">  uint32 b;</span><br><span class="line">  uint c;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>// 因为使用了结构打包，<code>mini</code> 比 <code>normal</code> 占用的空间更少<br>NormalStruct normal = NormalStruct(10, 20, 30);<br>MiniMe mini = MiniMe(10, 20, 30);<br>所以，当 uint 定义在一个 struct 中的时候，尽量使用最小的整数子类型以节约空间。 并且把同样类型的变量放一起（即在 struct 中将把变量按照类型依次放置），这样 Solidity 可以将存储空间最小化。例如，有两个 struct：</p>
<p>uint c; uint32 a; uint32 b; 和 uint32 a; uint c; uint32 b;</p>
<p>前者比后者需要的gas更少，因为前者把uint32放一起了。</p>
<h2 id="ch5-时间单位"><a href="#ch5-时间单位" class="headerlink" title="ch5. 时间单位"></a>ch5. 时间单位</h2><p>Solidity 使用自己的本地时间单位。</p>
<p>变量 <code>now</code> 将返回当前的unix时间戳（自1970年1月1日以来经过的秒数）。</p>
<p>Solidity 还包含秒(seconds)，分钟(minutes)，小时(hours)，天(days)，周(weeks) 和 年(years) 等时间单位。它们都会转换成对应的秒数放入 uint 中。所以 1分钟 就是 60，1小时是 3600（60秒×60分钟），1天是86400（24小时×60分钟×60秒），以此类推。</p>
<p>示例：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">uint lastUpdated;</span><br><span class="line"></span><br><span class="line">// 将‘上次更新时间’ 设置为 ‘现在’</span><br><span class="line">function updateTimestamp() public &#123;</span><br><span class="line">  lastUpdated = now;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 如果到上次`updateTimestamp` 超过5分钟，返回 &apos;true&apos;</span><br><span class="line">// 不到5分钟返回 &apos;false&apos;</span><br><span class="line">function fiveMinutesHavePassed() public view returns (bool) &#123;</span><br><span class="line">  return (now &gt;= (lastUpdated + 5 minutes));</span><br></pre></td></tr></table></figure></p>
<h2 id="ch6-结构体作为参数传入"><a href="#ch6-结构体作为参数传入" class="headerlink" title="ch6. 结构体作为参数传入"></a>ch6. 结构体作为参数传入</h2><p>由于结构体的存储指针可以以参数的方式传递给一个 private 或 internal 的函数，因此结构体可以在多个函数之间相互传递。</p>
<p>遵循这样的语法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">function _doStuff(Zombie storage _zombie) internal &#123;</span><br><span class="line">  // do stuff with _zombie</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="ch7-公有函数和安全性"><a href="#ch7-公有函数和安全性" class="headerlink" title="ch7. 公有函数和安全性"></a>ch7. 公有函数和安全性</h2><p>你必须仔细地检查所有声明为 public 和 external的函数，一个个排除用户滥用它们的可能，谨防安全漏洞。请记住，如果这些函数没有类似 onlyOwner 这样的函数修饰符，用户能利用各种可能的参数去调用它们。</p>
<h2 id="ch8-进一步了解函数修饰符"><a href="#ch8-进一步了解函数修饰符" class="headerlink" title="ch8. 进一步了解函数修饰符"></a>ch8. 进一步了解函数修饰符</h2><h3 id="带参数的函数修饰符"><a href="#带参数的函数修饰符" class="headerlink" title="带参数的函数修饰符"></a>带参数的函数修饰符</h3><p>之前我们已经读过一个简单的函数修饰符了：onlyOwner。函数修饰符也可以带参数。例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">// 存储用户年龄的映射</span><br><span class="line">mapping (uint =&gt; uint) public age;</span><br><span class="line"></span><br><span class="line">// 限定用户年龄的修饰符</span><br><span class="line">modifier olderThan(uint _age, uint _userId) &#123;</span><br><span class="line">  require(age[_userId] &gt;= _age);</span><br><span class="line">  _;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 必须年满16周岁才允许开车 (至少在美国是这样的).</span><br><span class="line">// 我们可以用如下参数调用`olderThan` 修饰符:</span><br><span class="line">function driveCar(uint _userId) public olderThan(16, _userId) &#123;</span><br><span class="line">  // 其余的程序逻辑</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>看到了吧， olderThan 修饰符可以像函数一样接收参数，是“宿主”函数 driveCar 把参数传递给它的修饰符的。</p>
<h2 id="ch10-利用-‘View’-函数节省-Gas"><a href="#ch10-利用-‘View’-函数节省-Gas" class="headerlink" title="ch10. 利用 ‘View’ 函数节省 Gas"></a>ch10. 利用 ‘View’ 函数节省 Gas</h2><h3 id="“view”-函数不花-“gas”"><a href="#“view”-函数不花-“gas”" class="headerlink" title="“view” 函数不花 “gas”"></a>“view” 函数不花 “gas”</h3><p>当玩家从外部调用一个view函数，是不需要支付一分 gas 的。</p>
<p>这是因为 view 函数不会真正改变区块链上的任何数据 - <code>它们只是读取</code>。因此用 view 标记一个函数，意味着告诉 web3.js，<code>运行这个函数只需要查询你的本地以太坊节点</code>，而不需要在区块链上创建一个事务（事务需要运行在每个节点上，因此花费 gas）。</p>
<p>稍后我们将介绍如何在自己的节点上设置 web3.js。但现在，你关键是要记住，在所能只读的函数上标记上表示“只读”的“external view 声明，就能为你的玩家减少在 DApp 中 gas 用量。</p>
<p>注意：如果一个 view 函数在另一个函数的内部被调用，而调用函数与 view 函数的不属于同一个合约，也会产生调用成本。这是因为如果主调函数在以太坊创建了一个事务，它仍然需要逐个节点去验证。所以标记为 view 的函数只有在外部调用时才是免费的。</p>
<h2 id="ch11-存储非常昂贵"><a href="#ch11-存储非常昂贵" class="headerlink" title="ch11. 存储非常昂贵"></a>ch11. 存储非常昂贵</h2><p>Solidity 使用storage(存储)是相当昂贵的，”写入“操作尤其贵。</p>
<p>这是因为，无论是写入还是更改一段数据， 这都将永久性地写入区块链。”永久性“啊！需要在全球数千个节点的硬盘上存入这些数据，随着区块链的增长，拷贝份数更多，存储量也就越大。这是需要成本的！</p>
<p>为了降低成本，不到万不得已，避免将数据写入存储。这也会导致效率低下的编程逻辑 - 比如每次调用一个函数，都需要在 memory(内存) 中重建一个数组，而不是简单地将上次计算的数组给存储下来以便快速查找。</p>
<p>在大多数编程语言中，遍历大数据集合都是昂贵的。但是在 Solidity 中，使用一个标记了external view的函数，遍历比 storage 要便宜太多，因为 view 函数不会产生任何花销。 （gas可是真金白银啊！）。</p>
<p>我们将在下一章讨论for循环，现在我们来看一下看如何如何在内存中声明数组。</p>
<p>在内存中声明数组<br>在数组后面加上 memory关键字， 表明这个数组是仅仅在内存中创建，不需要写入外部存储，并且在函数调用结束时它就解散了。与在程序结束时把数据保存进 storage 的做法相比，内存运算可以大大节省gas开销 – 把这数组放在view里用，完全不用花钱。</p>
<p>以下是申明一个内存数组的例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">function getArray() external pure returns(uint[]) &#123;</span><br><span class="line">  // 初始化一个长度为3的内存数组</span><br><span class="line">  uint[] memory values = new uint[](3);</span><br><span class="line">  // 赋值</span><br><span class="line">  values.push(1);</span><br><span class="line">  values.push(2);</span><br><span class="line">  values.push(3);</span><br><span class="line">  // 返回数组</span><br><span class="line">  return values;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个小例子展示了一些语法规则，下一章中，我们将通过一个实际用例，展示它和 for 循环结合的做法。</p>
<p>注意：内存数组 必须 用长度参数（在本例中为3）创建。目前不支持 array.push()之类的方法调整数组大小，在未来的版本可能会支持长度修改。</p>
<h2 id="使用-for-循环"><a href="#使用-for-循环" class="headerlink" title="使用 for 循环"></a>使用 for 循环</h2><p>for循环的语法在 Solidity 和 JavaScript 中类似。</p>
<p>来看一个创建偶数数组的例子：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">function getEvens() pure external returns(uint[]) &#123;</span><br><span class="line">  uint[] memory evens = new uint[](5);</span><br><span class="line">  // 在新数组中记录序列号</span><br><span class="line">  uint counter = 0;</span><br><span class="line">  // 在循环从1迭代到10：</span><br><span class="line">  for (uint i = 1; i &lt;= 10; i++) &#123;</span><br><span class="line">    // 如果 `i` 是偶数...</span><br><span class="line">    if (i % 2 == 0) &#123;</span><br><span class="line">      // 把它加入偶数数组</span><br><span class="line">      evens[counter] = i;</span><br><span class="line">      //索引加一， 指向下一个空的‘even’</span><br><span class="line">      counter++;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  return evens;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这个函数将返回一个形为 [2,4,6,8,10] 的数组。</p>

        </div>

        
            <div class="article-tags tags">
                
                    <a href="/tags/blockchain/"><i class="fa fa-tag fa-fw" aria-hidden="true"></i>&nbsp;blockchain</a>
                
                    <a href="/tags/智能合约/"><i class="fa fa-tag fa-fw" aria-hidden="true"></i>&nbsp;智能合约</a>
                
            </div>
        

        
            <div class="prev-next">
                
                    <section class="prev" >
                        <span class="art-item-left">
                            <h6><i class="fa fa-chevron-left" aria-hidden="true"></i>&nbsp;上一篇</h6>
                            <h4>
                                <a href="/2018/08/29/block_chain/搭建自己的私有网络/" rel="prev" title="搭建自己的私有网络">
                                    搭建自己的私有网络
                                </a>
                            </h4>
                            
                                <div class="tags">
                                    
                                        <i class="fa fa-tag fa-fw"></i>blockchain
                                    
                                        <i class="fa fa-tag fa-fw"></i>以太坊
                                    
                                </div>
                            
                        </span>
                    </section>
                
                
                    <section class="next">
                        <span class="art-item-right" aria-hidden="true">
                            <h6>下一篇&nbsp;<i class="fa fa-chevron-right" aria-hidden="true"></i></h6>
                            <h4>
                                <a href="/2018/08/29/block_chain/在私有网络上搭建3个以上节点/" rel="prev" title="">
                                    
                                </a>
                            </h4>
                            
                        </span>
                    </section>
                
            </div>
        

    </section>

</article>

<br>

<!-- 显示推荐文章和评论 -->

    <article class="post white-box comments">
        <section class="article typo">

            
                

    <div class="recommended_posts">
        <h4><i class="fa fa-bookmark fa-fw" aria-hidden="true"></i>&nbsp;你可能感兴趣的文章</h4>
        <ul>
            
                <li><a href="http://yoursite.com/2018/08/29/backend/java/Lombok原理分析与功能实现/">Lombok原理分析与功能实现</a></li>
            
                <li><a href="http://yoursite.com/2018/08/29/block_chain/搭建自己的私有网络/">搭建自己的私有网络</a></li>
            
                <li><a href="http://yoursite.com/2018/08/29/block_chain/在私有网络上搭建3个以上节点/"></a></li>
            
                <li><a href="http://yoursite.com/2018/08/29/backend/go/redis/redis_start_learn/">redis ops learn</a></li>
            
                <li><a href="http://yoursite.com/2018/08/29/backend/go/grpc/grpc_start_learn/">grpc start learn</a></li>
            
        </ul>
    </div>
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>


            

            

                

                

                
            

        </section>
    </article>


<script>
    window.subData = {
        title: 'Zombie T3',
        tools: true
    }
</script>


      </div>
      <aside class='l_side'>
        
  <section class='m_widget about'>
    <div class='header'>
        
            <img class='avatar' src='https://github.com/jie-think/github_blog_prd/blob/master/img/heard.jpg' />
        
    </div>
    <div class='content'>
        
        <div>
            <i class="fa fa-quote-left fa-3x fa-pull-left" aria-hidden="true"></i>
            
                The only way to learn it is to do it.
            
        </div>
    </div>
    
        <div class="social-wrapper">
          
            
                <a href="qq646958863@163.com" class="social envelope"
                    target="_blank" rel="external">
                <i class="fa fa-envelope fa-fw"></i>
                </a>
            
          
            
                <a href="https://github.com/jie-think" class="social github"
                    target="_blank" rel="external">
                <i class="fa fa-github fa-fw"></i>
                </a>
            
          
            
          
            
          
            
          
            
          
        </div>
    

</section>


  <section class='m_widget categories'>
<div class='header'><i class="fa fa-sitemap fa-fw" aria-hidden="true"></i>&nbsp;&nbsp;分类</div>
<div class='content'>
    
    <ul class="entry">
    
        <li><a class="flat-box" href="/categories/alg/"><div class='name'>alg</div><div class='badge'>4</div></a></li>
    
        <li><a class="flat-box" href="/categories/backend/"><div class='name'>backend</div><div class='badge'>10</div></a></li>
    
        <li><a class="flat-box" href="/categories/build-own-x/"><div class='name'>build-own-x</div><div class='badge'>2</div></a></li>
    
        <li><a class="flat-box" href="/categories/devops/"><div class='name'>devops</div><div class='badge'>1</div></a></li>
    
        <li><a class="flat-box" href="/categories/frontend/"><div class='name'>frontend</div><div class='badge'>2</div></a></li>
    
        <li><a class="flat-box" href="/categories/frontend/learn-notebook/"><div class='name'>learn notebook</div><div class='badge'>1</div></a></li>
    
    </ul>
    
</div>
</section>


  
<section class="m_widget tagcloud">
    <div class="header"><i class="fa fa-tags fa-fw" aria-hidden="true"></i>&nbsp;&nbsp;标签</div>
    <div class='content'>
        <a href="/tags/apidoc/" style="font-size: 14px; color: #999">apidoc</a> <a href="/tags/blockchain/" style="font-size: 19px; color: #777">blockchain</a> <a href="/tags/build-tools/" style="font-size: 14px; color: #999">build tools</a> <a href="/tags/css/" style="font-size: 19px; color: #777">css</a> <a href="/tags/css-grid/" style="font-size: 19px; color: #777">css grid</a> <a href="/tags/database/" style="font-size: 19px; color: #777">database</a> <a href="/tags/db原理/" style="font-size: 19px; color: #777">db原理</a> <a href="/tags/docker/" style="font-size: 14px; color: #999">docker</a> <a href="/tags/docker-app/" style="font-size: 14px; color: #999">docker app</a> <a href="/tags/go/" style="font-size: 24px; color: #555">go</a> <a href="/tags/goose/" style="font-size: 14px; color: #999">goose</a> <a href="/tags/grpc/" style="font-size: 14px; color: #999">grpc</a> <a href="/tags/java/" style="font-size: 19px; color: #777">java</a> <a href="/tags/learn/" style="font-size: 14px; color: #999">learn</a> <a href="/tags/lombok/" style="font-size: 14px; color: #999">lombok</a> <a href="/tags/markdown/" style="font-size: 14px; color: #999">markdown</a> <a href="/tags/redis/" style="font-size: 14px; color: #999">redis</a> <a href="/tags/sorting/" style="font-size: 14px; color: #999">sorting</a> <a href="/tags/spring-aop/" style="font-size: 14px; color: #999">spring aop</a> <a href="/tags/supervisor/" style="font-size: 14px; color: #999">supervisor</a> <a href="/tags/tools安装/" style="font-size: 14px; color: #999">tools安装</a> <a href="/tags/以太坊/" style="font-size: 14px; color: #999">以太坊</a> <a href="/tags/动态规划/" style="font-size: 24px; color: #555">动态规划</a> <a href="/tags/原理/" style="font-size: 14px; color: #999">原理</a> <a href="/tags/智能合约/" style="font-size: 14px; color: #999">智能合约</a> <a href="/tags/题集/" style="font-size: 14px; color: #999">题集</a>
    </div>
</section>



  


  


  
    <section class="m_widget toc-wrapper">
        <div class="header"><i class="fa fa-list fa-fw" aria-hidden="true"></i>&nbsp;&nbsp;目录</div>
        <div class='content'>
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#ch1-智能协议的永固性"><span class="toc-text">ch1. 智能协议的永固性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ch2-Ownable-Contracts"><span class="toc-text">ch2. Ownable Contracts</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ch4-Gas"><span class="toc-text">ch4. Gas</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#为什么要用-gas-来驱动？"><span class="toc-text">为什么要用 gas 来驱动？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#省-gas-的招数：结构封装-（Struct-packing）"><span class="toc-text">省 gas 的招数：结构封装 （Struct packing）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ch5-时间单位"><span class="toc-text">ch5. 时间单位</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ch6-结构体作为参数传入"><span class="toc-text">ch6. 结构体作为参数传入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ch7-公有函数和安全性"><span class="toc-text">ch7. 公有函数和安全性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ch8-进一步了解函数修饰符"><span class="toc-text">ch8. 进一步了解函数修饰符</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#带参数的函数修饰符"><span class="toc-text">带参数的函数修饰符</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ch10-利用-‘View’-函数节省-Gas"><span class="toc-text">ch10. 利用 ‘View’ 函数节省 Gas</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#“view”-函数不花-“gas”"><span class="toc-text">“view” 函数不花 “gas”</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ch11-存储非常昂贵"><span class="toc-text">ch11. 存储非常昂贵</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#使用-for-循环"><span class="toc-text">使用 for 循环</span></a></li></ol>
        </div>
    </section>




      </aside>
      <script>setLoadingBarProgress(60);</script>
    </div>
  </div>
  <footer id="footer" class="clearfix">
    <div class="social-wrapper">
      
        
            <a href="qq646958863@163.com" class="social envelope flat-box"
                target="_blank" rel="external">
            <i class="fa fa-envelope fa-fw"></i>
            </a>
        
      
        
            <a href="https://github.com/jie-think" class="social github flat-box"
                target="_blank" rel="external">
            <i class="fa fa-github fa-fw"></i>
            </a>
        
      
        
      
        
      
        
      
        
      
    </div>
    <br>
    <div>博客内容遵循 <a target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" class="licenses">知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a></div>
    <div>本站使用 <a href="https://github.com/xaoxuu/hexo-theme-material-x" target="_blank" class="codename">Material-X</a> 作为主题，
		总访问量为 <span id="busuanzi_value_site_pv"><i class="fa fa-spinner fa-spin fa-fw" aria-hidden="true"></i></span> 次。
    </div>

</footer>
<!-- 根据页面mathjax变量决定是否加载MathJax数学公式js -->


  <script>setLoadingBarProgress(80);</script>
  <script src="//apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
<script src='//cdn.bootcss.com/node-waves/0.7.5/waves.min.js'></script>
<script src="//cdn.bootcss.com/scrollReveal.js/3.3.2/scrollreveal.min.js"></script>
<!-- 访问统计 -->
<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>


<script src="/js/jquery.fitvids.js"></script>
<script>
var GOOGLE_CUSTOM_SEARCH_API_KEY = "";
var GOOGLE_CUSTOM_SEARCH_ENGINE_ID = "";
var ALGOLIA_API_KEY = "";
var ALGOLIA_APP_ID = "";
var ALGOLIA_INDEX_NAME = "";
var AZURE_SERVICE_NAME = "";
var AZURE_INDEX_NAME = "";
var AZURE_QUERY_KEY = "";
var BAIDU_API_ID = "";
var SEARCH_SERVICE = "hexo";
var ROOT = "/"||"/";
if(!ROOT.endsWith('/'))ROOT += '/';
</script>
<script src="/js/search.js"></script>
<script src="/js/app.js"></script>


    
    
    


  <script>setLoadingBarProgress(100);</script>
</body>
</html>
